import os
import numpy as np
from absl import app
from cumulo.utils.visualization import outputs_to_figure_or_file
from absl import flags

flags.DEFINE_string('path', None, help='Directory where npz files are located.')
flags.DEFINE_boolean('make_cloud_mask_binary', True, help='Make cloud mask binary')
flags.DEFINE_boolean('to_file', True, help='Save examples as images')
flags.DEFINE_boolean('no_cloud_mask', False, help='Predictions were generated by model without cloud mask prediction')
flags.DEFINE_integer('label_dilation', 10, help='Size of label dilation')

FLAGS = flags.FLAGS


def main(_):
    files = list(filter(lambda f: 'npz' in f, os.listdir(FLAGS.path)))
    for file in files:
        print(file)
        file = os.path.join(FLAGS.path, file)
        data = np.load(file)
        outputs_to_figure_or_file(data['outputs'], data['labels'], data['cloud_mask'], make_cloud_mask_binary=FLAGS.make_cloud_mask_binary,
                                  to_file=FLAGS.to_file, npz_file=file, label_dilation=FLAGS.label_dilation, no_cloud_mask_prediction=FLAGS.no_cloud_mask)


if __name__ == '__main__':
    app.run(main)
